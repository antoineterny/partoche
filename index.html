<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Lecteur de partoche</title>
        <link href="normalize.css" rel="stylesheet" type="text/css">
        <style>
            @import url('https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica&display=swap');
            body {
                font-family: 'IM Fell DW Pica', serif;
            }
            h1 {
                text-align: center;
                text-transform: uppercase;
            }
            .conteneur {
                max-width: 1200px;
                margin: auto;
            }
            .partoche-viewer {
                max-width: 1200px;
                height: 400px;
                /* border: 1px solid black; */
                position: relative;
                margin-bottom: 1em;
            }
            .partoche-viewer img {
                top: 50%;                         
                position: absolute;               
                transform: translate(0, -50%) }
            .audio-control {
                display: flex;
            }
            .audio-control button {
                display: inline-block;
                width: 30px;
                height: 30px;
                border: none;
                padding: 0;
                vertical-align: middle;
                text-indent: -9999px; 
            }
            #play-button {
                background: url(img/playB.png);
                margin-right: 2px;
                flex-grow: 0;
            }
            /* #play-button:hover {
                background: url(img/playW.png);
            } */
            #stop-button {
                background: url(img/stopB.png);
                margin-right: 2px;
                flex-grow: 0;
            }
            /* #stop-button:hover {
                background: url(img/stopW.png);
            } */
            #progressBarControl {
                /* display: inline-block;
                width: 1133px; */
                height: 30px;
                flex-grow: 50;
            }
            #progressBar {
                color: white;
                background-color: black ;
                height: 30px;
                font-size: 24px;
                vertical-align: middle;
                line-height: 30px;
                flex-grow: 50;
            }
        </style>
    </head>
    <body>
        <div class="conteneur">
            <h1>Chopin - Prélude Op. 28, No.10</h1>
            <div class="partoche-viewer">
                <img id="partoche" src="prelude10/slice1.png" style="width: 100%;">
            </div>

            <div class="audio-control">
                <audio id='lecteurAudio' src='prelude10/prelude10.mp3' ontimeupdate="update(this)"></audio>
                <button class='control' id="play-button" onclick='play("lecteurAudio", this)'>Lecture</button>
                <button class='control' id="stop-button" onclick='resume("lecteurAudio", this)'>Arrêt</button>
                <div id="progressBarControl">
                    <div id="progressBar">&nbsp;00:00</div>
                </div>
            </div>
        </div>
        <script>
            const markers = await fetch('prelude10/prelude10 reaper_regions_markers.csv')
                .then(response => { return response.text() })
            // const markers = "#,Name,Start,End,Length↵M1,,0:02.620,,↵M2,,0:07.962,,↵M3,,0:12.119,,↵M4,,0:17.656,,↵"
            // let markersArray = markers.split(",");
            

            function play(idPlayer, control) {
                let player = document.querySelector('#' + idPlayer);
                if (player.paused) {
                    player.play();
                    control.textContent = 'Pause';
                    control.style.background = 'url(img/pauseB.png)';
                } else {
                    player.pause();
                    control.textContent = 'Reprendre';
                    control.style.background = 'url(img/playB.png)';
                }
            }
            function resume(idPlayer) {
                let player = document.querySelector('#' + idPlayer);
                player.currentTime = 0;
                player.pause();
            }
            function update(player) {
                var duration = player.duration;    // Durée totale
                var time     = player.currentTime; // Temps écoulé
                var fraction = time / duration;
                var percent  = Math.ceil(fraction * 100);
                var progress = document.querySelector('#progressBar');
                let partoche = document.querySelector("#partoche");

                progress.style.width = percent + '%';
                document.querySelector('#progressBar').innerHTML = "&nbsp;" + formatTime(time);

                if (time < "02.620") {
                    partoche.src = "prelude10/slice1.png"
                } else if (time > "02.620" && time < "07.962") {
                    partoche.src = "prelude10/slice2.png"
                } else if (time > "07.962" && time < "12.119") {
                    partoche.src = "prelude10/slice3.png"
                } else if (time > "12.119" && time < "17.656") {
                    partoche.src = "prelude10/slice4.png"
                } else if (time > "17.656") {
                    partoche.src = "prelude10/slice5.png"
                }
            }
            function formatTime(time) {
                var hours = Math.floor(time / 3600);
                var mins  = Math.floor((time % 3600) / 60);
                var secs  = Math.floor(time % 60);
                if (secs < 10) {
                    secs = "0" + secs;
                }
                if (hours) {
                    if (mins < 10) {
                        mins = "0" + mins;
                    }
                    return hours + ":" + mins + ":" + secs; // hh:mm:ss
                } else {
                    return mins + ":" + secs; // mm:ss
                }
            }
            function getMousePosition(event) {
                return {
                    x: event.pageX,
                    y: event.pageY
                }
            }
        </script>
    </body>
</html>